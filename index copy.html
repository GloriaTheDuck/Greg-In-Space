<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sprint 1 - Level 6</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
      body {
        padding: 0px;
        margin: 10px;
      }
    </style>
  </head>
  <body>
  <script type="text/javascript">


      var player;
      var rocks;
      var executives;
      var walls;
      var exit;
      var gameOver = false;

      var scene = new Phaser.Scene("Scene")

      scene.preload = function ()
      {
          this.load.image('flooring', 'tileset.png');
          this.load.image('rocks', 'addwork.png');
          this.load.image('executives', 'EyeBall Monster-Sheet.png');
          this.load.image('character_right', 'Character_Right.png');
          this.load.image('character_left', 'Character_Left.png');
          this.load.image('character_up', 'Character_Up.png');
          this.load.image('character_down', 'Character_Down.png');
          this.load.tilemapTiledJSON('tilemap', 'Level6JSON.json')

      }

      scene.create = function ()
      {
          const map = this.make.tilemap({ key: "tilemap" });

          const tileset = map.addTilesetImage("Flooring", "flooring");

          // Parameters: layer name (or index) from Tiled, tileset, x, y
          const blocksLayer = map.createStaticLayer("Black Blocks", tileset, 0, 0);
          const backgroundLayer = map.createStaticLayer("Background", tileset, 0, 0);

          backgroundLayer.setCollisionByProperty( {collides : true} )

          const spawnPoint = map.findObject("Object Layer", obj => obj.name === "spawnPoint");
          player = this.physics.add.sprite(spawnPoint.x, spawnPoint.y, "character_right");

          this.anims.create({
              key: 'left',
              frames: this.anims.generateFrameNumbers('character_left', { start: 0, end: 3 }),
              frameRate: 10,
              repeat: -1
          });

          this.anims.create({
              key: 'up',
              frames: this.anims.generateFrameNumbers("character_up", { start: 0, end: 3 } ),
              frameRate: 10
          });

          this.anims.create({
              key: 'right',
              frames: this.anims.generateFrameNumbers('character_right', { start: 0, end: 3 }),
              frameRate: 10,
              repeat: -1
          });

          this.anims.create({
              key: 'down',
              frames: this.anims.generateFrameNumbers('character_down', { start: 0, end: 3 }),
              frameRate: 10,
              repeat: -1
          });

          cursors = this.input.keyboard.createCursorKeys();


          executives = this.physics.add.group({
              key: 'executives',
              repeat: 2,
              setXY: { x: 12, y: 0, stepX: 70 }
          });

          this.physics.add.collider(player, backgroundLayer);

          //this.physics.add.overlap(player, executives, scene.collectExec, null, this);
      }

      scene.update = function ()
      {
        if (gameOver)
        {
            return;
        }

        if (cursors.left.isDown) {
            player.body.setVelocityX(-100);
          }
          else if (cursors.right.isDown) {
            player.body.setVelocityX(100);
          }


        if (cursors.up.isDown) {
            player.body.setVelocityY(-100);
          }
          else if (cursors.down.isDown) {
            player.body.setVelocityY(100);
          }
      }


      scene.collectExec = function (player, executives)
      {
          executives.disableBody(true, true);
      }




      scene.leave = function (player)
      {
          this.add.text(300, 300, "Level Cleared!", {fontSize: "32px", fill: "#FFF"});
          gameOver = true;
      }


      var config = {
          type: Phaser.AUTO,
          width: 800,
          height: 600,
          physics: {
              default: 'arcade',
              arcade: {
                  gravity: { y: 0 },
              }
          },
          scene: [scene]
      };

      var game = new Phaser.Game(config);


  </script>
  </body>

</html>
