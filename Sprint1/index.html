<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sprint 1 - Level 6</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
      body {
        padding: 0px;
        margin: 10px;
      }
    </style>
  </head>
  <body>
  <script type="text/javascript">


      var player;
      var rocks;
      var executives;
      var walls;
      var exit;
      var gameOver = false;

      var scene = new Phaser.Scene("Scene")

      scene.preload = function ()
      {
          this.load.image('flooring', 'tileset.png');
          this.load.image('rocks', 'addwork.png');
          this.load.spritesheet('alien', 'aliensprite_idle.png', { frameWidth: 32, frameHeight: 32 } );
          this.load.spritesheet('character_right', 'sprite_right.png', { frameWidth: 32, frameHeight: 32 } );
          this.load.spritesheet('character_left', 'sprite_left.png', { frameWidth: 32, frameHeight: 32 });
          this.load.spritesheet('character_up', 'sprite_up.png', { frameWidth: 32, frameHeight: 32 });
          this.load.spritesheet('character_down', 'sprite_down.png', { frameWidth: 32, frameHeight: 32 });
          this.load.tilemapTiledJSON('tilemap', 'Level6.json');

      }

      scene.create = function ()
      {
          const map = this.make.tilemap({ key: "tilemap", tileWidth: 32, tileHeight: 32 });

          const tileset = map.addTilesetImage("Floor", "flooring");

          // Parameters: layer name (or index) from Tiled, tileset, x, y
          const blocksLayer = map.createStaticLayer("Color Fill", tileset, 0, 0);
          const backgroundLayer = map.createStaticLayer("Background", tileset, 0, 0);
          const wallLayer = map.getObjectLayer("Walls")['objects'];
          const groupLayer = map.getObjectLayer("Group")['objects'];
          const playerLayer = map.getObjectLayer("Player")['objects'];


          //backgroundLayer.setCollisionByProperty( {collides : true} );

          const spawnPoint = map.findObject("Player", obj => obj.name === "playerSpawn");
          player = this.physics.add.sprite(spawnPoint.x, spawnPoint.y, "character_right");
          player.setCollideWorldBounds(true);

          this.anims.create({
              key: 'left',
              frames: this.anims.generateFrameNumbers('character_left', { start: 0, end: 3 }),
              frameRate: 10,
              repeat: -1
          });

          this.anims.create({
              key: 'up',
              frames: this.anims.generateFrameNumbers("character_up", { start: 0, end: 3 } ),
              frameRate: 10
          });

          this.anims.create({
              key: 'right',
              frames: this.anims.generateFrameNumbers('character_right', { start: 0, end: 3 } ),
              frameRate: 10,
              repeat: -1
          });

          this.anims.create({
              key: 'down',
              frames: this.anims.generateFrameNumbers('character_down', { start: 0, end: 3 }),
              frameRate: 10,
              repeat: -1
          });

          cursors = this.input.keyboard.createCursorKeys();

          /*
          alienGroup = this.physics.add.staticGroup()
          groupLayer.forEach(object => {
          let obj = alienGroup.create(object.x, object.y, "alien");
             obj.setScale(object.width/32, object.height/32);

             obj.body.width = object.width;
             obj.body.height = object.height;
          });

      //collisons

          this.physics.add.overlap(player, alienGroup, scene.collectAliens, null, this);

          alienGroup = this.physics.add.group({
              key: 'alien'
          });
          */

          //this.physics.add.overlap(player, executives, scene.collectExec, null, this);
      }

      scene.update = function ()
      {
        if (gameOver)
        {
            return;
        }

        if (cursors.left.isDown) {
            player.body.setVelocityX(-100);
            player.anims.play('left', true);
          }

        else if (cursors.right.isDown) {
            player.body.setVelocityX(100);
            player.anims.play('right', true);
          }

        else if (cursors.up.isDown) {
            player.body.setVelocityY(-100);
            player.anims.play('up', true);
          }

        else if (cursors.down.isDown) {
            player.body.setVelocityY(100);
            player.anims.play('down', true);
          }

        else
        {
            player.setVelocityX(0);
            player.setVelocityY(0);
            player.anims.stop()
        }
      }

      scene.collectAliens = function (player, alienGroup)
      {
          alienGroup.disableBody(true, true);
      }

      scene.leave = function (player)
      {
          this.add.text(16, 16, "Level Cleared!", {fontSize: "32px", fill: "#FFF"});
          gameOver = true;
      }

      var config = {
          type: Phaser.AUTO,
          width: 256,
          height: 224,
          physics: {
              default: 'arcade',
              arcade: {
                  gravity: { y: 0 },
              }
          },
          scene: [scene]
      };

      var game = new Phaser.Game(config);


  </script>
  </body>

</html>
